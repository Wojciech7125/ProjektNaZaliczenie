version: '3.8'

services:
  android-builder:
    build: .
    container_name: zlecenia-pro-builder
    volumes:
      - .:/app
      - android-cache:/root/.buildozer
      - gradle-cache:/root/.gradle
    environment:
      - GRADLE_USER_HOME=/root/.gradle
    working_dir: /app
    command: |
      bash -c "
        echo 'ğŸ”§ Przygotowywanie Å›rodowiska budowania...'
        
        # Inicjalizuj buildozer jeÅ›li potrzeba
        if [ ! -f buildozer.spec ]; then
          echo 'ğŸ“ Tworzenie buildozer.spec...'
          buildozer init
        fi
        
        echo 'ğŸš€ Rozpoczynam budowanie APK...'
        buildozer android debug
        
        echo 'âœ… Budowanie zakoÅ„czone!'
        echo 'ğŸ“± APK znajduje siÄ™ w folderze bin/'
        ls -la bin/
      "

volumes:
  android-cache:
    driver: local
  gradle-cache:
    driver: local