services:
  android-builder:
    build: .
    container_name: zlecenia-pro-builder
    volumes:
      - .:/app
      - android-cache:/root/.buildozer
      - gradle-cache:/root/.gradle
    environment:
      - GRADLE_USER_HOME=/root/.gradle
      - BUILDOZER_WARN_ON_ROOT=0
    working_dir: /app
    stdin_open: true
    tty: true
    command: |
      bash -c "
        echo 'ğŸ”§ Przygotowywanie Å›rodowiska budowania...'
        
        # Inicjalizuj buildozer jeÅ›li potrzeba
        if [ ! -f buildozer.spec ]; then
          echo 'ğŸ“ Tworzenie buildozer.spec...'
          buildozer init
        fi
        
        echo 'ğŸš€ Rozpoczynam budowanie APK z automatycznÄ… akceptacjÄ… licencji...'
        yes | buildozer android debug
        
        echo 'âœ… Budowanie zakoÅ„czone!'
        echo 'ğŸ“± APK znajduje siÄ™ w folderze bin/'
        ls -la bin/ || echo 'Folder bin/ nie istnieje jeszcze'
      "

volumes:
  android-cache:
    driver: local
  gradle-cache:
    driver: local